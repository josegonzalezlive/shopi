<style>
    /*
        Section styling
    */
    #custom-marquee-text-{{ section.id }} {
        overflow: hidden;
        {% unless section.settings.bg_color == 'rgba(0,0,0,0)' %}
            background-color: {{ section.settings.bg_color }};
        {% endunless %}
        {% unless section.settings.color == 'rgba(0,0,0,0)' %}
            color: {{ section.settings.color }};
        {% endunless %}
        padding-top: {{ section.settings.pt }}rem;
        padding-bottom: {{ section.settings.pb }}rem;
        margin-top: {{ section.settings.mt }}rem;
        margin-bottom: {{ section.settings.mb }}rem;
    }
    
    #custom-marquee-text-{{ section.id }} ul {
        list-style: none;
        margin: 0;
        padding: 0;
        display: inline-flex;
        animation-timing-function: linear;
        animation-iteration-count: infinite;
    }

    #custom-marquee-text-{{ section.id }} ul:hover {
        animation-play-state: paused;
    }

    #custom-marquee-text-{{ section.id }} ul li {
        position: relative;
        flex-shrink: 0;
        padding-left: {{ section.settings.gap }}px;
        padding-right: {{ section.settings.gap }}px;
    }
    
    #custom-marquee-text-{{ section.id }} ul li::after {
        content: "";
        background-color: currentColor;
        mask-image: url("data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg version='1.1' width='10px' height='10px' viewBox='0 0 10.0 10.0' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cdefs%3E%3CclipPath id='i0'%3E%3Cpath d='M10,0 L10,10 L0,10 L0,0 L10,0 Z'%3E%3C/path%3E%3C/clipPath%3E%3CclipPath id='i1'%3E%3Cpath d='M5,0 C7.76142375,0 10,2.23857625 10,5 C10,7.76142375 7.76142375,10 5,10 C2.23857625,10 0,7.76142375 0,5 C0,2.23857625 2.23857625,0 5,0 Z'%3E%3C/path%3E%3C/clipPath%3E%3C/defs%3E%3Cg clip-path='url(%23i0)'%3E%3Cg clip-path='url(%23i1)'%3E%3Cpolygon points='0,0 10,0 10,10 0,10 0,0' stroke='none' fill='currentColor'%3E%3C/polygon%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-size: cover;
        width: .25rem;
        height: .25rem;
        position: absolute;
        right: 0;
        top: 50%;
        transform: translate(50%, -50%);
    }

    @media (prefers-reduced-motion:reduce) {
        #custom-marquee-text-{{ section.id }} ul {
            animation: none
        }
    }
    

    /*
        Various classes
    */
    #custom-marquee-text-{{ section.id }} .text-sm {
        font-size: .8em;
    }

    #custom-marquee-text-{{ section.id }} .text-lg {
        font-size: 1.2em;
    }

    #custom-marquee-text-{{ section.id }} .fw-bold {
        font-weight: bold;
    }

    #custom-marquee-text-{{ section.id }} .text-uppercase {
        text-transform: uppercase;
    }

    #custom-marquee-text-{{ section.id }} .text-capitalize {
        text-transform: capitalize;
    }

  /* ... existing CSS ... */

#custom-marquee-text-{{ section.id }} a {
    {% unless section.settings.link_color == 'rgba(0,0,0,0)' %}
        color: {{ section.settings.link_color }};
    {% endunless %}
}

</style>

<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        const init = () => {
            const list = document.querySelector('#custom-marquee-text-{{ section.id }} ul')
            const marqueeWidth = list.scrollWidth
            const marqueeLength = list.querySelectorAll('li').length
    
            list.insertAdjacentHTML('beforeEnd', list.innerHTML)
            list.insertAdjacentHTML('beforeEnd', list.innerHTML)
    
            list.querySelectorAll('li').forEach((item, index) => {
                if (index >= marqueeLength) {
                    item.setAttribute('aria-hidden', 'true')
                }
            })
    
            let style = `
                <style>
                    #custom-marquee-text-{{ section.id }} ul {
                        animation-name: marquee-animation-${list.dataset.sectionId};
                        animation-duration: ${list.dataset.animationDuration}s;
                    }
                    @keyframes marquee-animation-${list.dataset.sectionId} {
                        to { transform: translateX(-${marqueeWidth}px); }
                    }
                </style>
            `
            if (list.dataset.marqueeDirection === 'right') {
                style += `
                    <style>
                        @keyframes marquee-animation-${list.dataset.sectionId} {
                            from { transform: translateX(-${marqueeWidth}px); }    
                            to { transform: 0); }    
                        }
                    </style>
                `
            }
    
            list.insertAdjacentHTML('beforeBegin', style)
        }

        init()

        document.addEventListener('shopify:section:load', (e) => {
            if (e.target.querySelector('#custom-marquee-text-{{ section.id }}')) {
                init()
            }
        })
    })
</script>

<section 
    id="custom-marquee-text-{{ section.id }}" 
    class="custom-marquee-text {{ section.settings.text_direction }}">
    {% unless section.settings.url == blank %}
        <a href="{{ section.settings.url }}">
    {% endunless %}
        <ul 
            class="{{ section.settings.text_size }} {{ section.settings.text_weight }} {{ section.settings.text_transform }}"
            data-animation-duration="{{ section.settings.animation_duration }}"
            data-marquee-direction="{{ section.settings.marquee_direction }}"
            data-section-id="{{ section.id }}"
            aria-label="{{ section.settings.list_label }}">
          {% for block in section.blocks %}
    <li class="">
        {% if block.settings.link %}
      <a href="{{ block.settings.link }}" >{{ block.settings.text }}</a>
        {% else %}
            {{ block.settings.text }}
        {% endif %}
    </li>
{% endfor %}



        </ul>
    {% unless section.settings.url == blank %}
        </a>
    {% endunless %}
</section>

{% schema %}
{
    "name": "Custom Marquee text",
    "settings": [
        {
            "type": "header",
            "content": "General"
        },
        {
            "type": "color",
            "id": "bg_color",
            "label": "Background color"
        },
        {
            "type": "color",
            "id": "color",
            "label": "Text color"
        },
     {
  "type": "color",
  "id": "link_color",
"label": "Link color",
  "default": "#000000"
},
        {
            "type": "select",
            "id": "text_size",
            "label": "Text size",
            "default": "",
            "options": [
                { "value": "text-sm", "label": "Small" },
                { "value": "", "label": "Default" },
                { "value": "text-lg", "label": "Large" }
            ]
        },
        {
            "type": "select",
            "id": "text_weight",
            "label": "Font weight",
            "default": "",
            "options": [
                { "value": "", "label": "Normal" },
                { "value": "fw-bold", "label": "Bold" }
            ]
        },
        {
            "type": "select",
            "id": "text_transform",
            "label": "Text transform",
            "default": "",
            "options": [
                { "value": "", "label": "Normal" },
                { "value": "text-uppercase", "label": "Uppercase" },
                { "value": "text-capitalize", "label": "Capitalize" }
            ]
        },
        {
            "type": "text",
            "id": "list_label",
            "label": "List label",
            "default": "Promotional Features",
            "info": "Used for accessibility purposes"
        },
        {
            "type": "header",
            "content": "Effect"
        },
        {
            "type": "range",
            "id": "animation_duration",
            "label": "Animation duration",
            "min": 0,
            "max": 60,
            "step": 1,
            "default": 15,
            "unit": "sec"
        },
        {
            "type": "select",
            "id": "marquee_direction",
            "label": "Marquee direction",
            "default": "left",
            "options": [
                { "value": "left", "label": "Left" },
                { "value": "right", "label": "Right" }

            ]
        },
        {
            "type": "header",
            "content": "Gap",
            "info": "Based on 'rem' values [Learn more](https://developer.mozilla.org/en-US/docs/Learn/CSS/Building_blocks/Values_and_units)"
        },
        {
            "type": "range",
            "id": "gap",
            "label": "Gap",
            "info": "Between repeated text",
            "min": 0,
            "max": 40,
            "step": 1,
            "default": 20
        },
        {
            "type": "header",
            "content": "Spacing",
            "info": "Based on 'rem' values [Learn more](https://developer.mozilla.org/en-US/docs/Learn/CSS/Building_blocks/Values_and_units)"
        },
        {
            "type": "range",
            "id": "pt",
            "label": "Padding top",
            "min": 0,
            "max": 12,
            "step": 1,
            "default": 1
        },
        {
            "type": "range",
            "id": "pb",
            "label": "Padding bottom",
            "min": 0,
            "max": 12,
            "step": 1,
            "default": 1
        },
        {
            "type": "range",
            "id": "mt",
            "label": "Margin top",
            "min": 0,
            "max": 12,
            "step": 1,
            "default": 0
        },
        {
            "type": "range",
            "id": "mb",
            "label": "Margin bottom",
            "min": 0,
            "max": 12,
            "step": 1,
            "default": 0
        }
    ],
    "blocks": [
 {
    "type": "item",
    "name": "Item",
    "settings": [
        {
            "type": "text",
            "id": "text",
            "label": "Text"
        },
        {
            "type": "url",
            "id": "link",
            "label": "Link URL",
            "info": "Enter the URL you want to link to."
        }
    ]
}


    ],
    "presets": [
        {
            "name": "Custom Marquee text",
            "category": "Text"
        }
    ]
}
{% endschema %}
